{% extends "base.html" %}
{% load static %}
{% load price_filters %}
{% block cart-content %}

<div class="cart Container">
    <h1><strong>Giỏ hàng của tôi</strong></h1>
    <form action="">
    <div class="Main-Content">
        <div class="Product-table card">
            <div class="visually-hidden">
                <span>Tất cả sản phẩm</span>
                <input type="radio" name="" id="">
            </div>
           <table style="width: 100%;">
            <colgroup>
                <col style="width: 10%;">
                <col style="width: 70%;">
                <col style="width: 20%;">
            </colgroup>
            <thead>
            <tr>
                <th class="tb-head-img"><span>Sản phẩm</span></th>
                <th class="tb-head-detail"><span class="visually-hidden">Details</span></th>
                <th class="tb-head-total"><span>Tổng giá</span></th>
            </tr>
            </thead>
            <tbody>
            {% for item in items %}
            <tr>
                <td class="tb-body-img">
                    <div style="display: flex; gap: 15px;">
                        <img src="{{item.product.ImageUrl}}" alt="Cork Container" class = "rounded">
                    </div>
                </td>
                <td class="tb-body-details">
                    <div>
                        <a href="{% url 'product' %}?id={{item.product.id}}" class="product-title">{{item.product.name}}</a>
                        <br>
                        {% if item.discounted_price < item.product.price %}
                            <span class="old-price">{{ item.product.price }}</span>
                            <span class="new-price">
                                {{ item.discounted_price|format_price }}
                            </span>
                            <br>
                            <span class="sale">SAVE {{ item.product.price|format_price|add:"-"|add:item.discounted_price|format_price }}</span>
                        {%else%}
                            <span class="new-price">{{ item.discounted_price|format_price }}</span>    
                        {%endif%} 
                        <p class="description">Một sản phẩm vô cùng chất lượng đến từ nhà STAX</p>
                    <div class="quantity-box">
                        <button type="button" data-product = {{item.product.id}} data-action = 'minus' class="btn update-cart">-</button>
                        <input type="number" id="quantity" value="{{item.quantity}}" min="1">
                        <button type="button" data-product = {{item.product.id}} data-action = 'add' class="btn update-cart">+</button>
                    </div>
                    <br>
                    <a href="#" class="remove-link update-cart" data-product = {{item.product.id}} data-action = 'remove'>Remove item</a>
                    </div>
                </td>    
                <td class="tb-body-total">
                    <span class="total-price">
                    {{ item.get_discounted_total|format_price }}
                    </span>
                    <span class="sale-total">
                    SAVE {{ item.get_saved_amount|format_price }}
                    </span>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td></td>
                <td>
                    {% if user.is_authenticated %}
                        Hãy mua sắm và thêm vào giỏ hàng nào !
                    {% else %}
                        Bạn cần phải <a href="#" class="link" onclick="window.location.href='/Login/#login-form'">Đăng nhập</a> để có thể thêm sản phẩm.
                    {% endif %}
                </td>
            </tr>
             {% endfor %}
            </tbody>
           </table>    
        </div>
        <div class="Cart-Totals SubContainer w-45">
            <div class="card">
                <div class="card-title">
                    <h3>Bảng giá sản phẩm</h3>
                </div>
                <hr>
                <div class="AddVoucher">
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                <span>Thêm voucher khuyến mãi</span>
                            </button>
                            <i class="bi bi-chevron-down ms-2 transition-icon" id="voucherIcon"></i>
                        </h2>
                        <div id="collapseOne" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
                            <div class="accordion-body">
                                <div class="InputVoucher">
                                    <input type="text" id="InputVoucher" class="form-control" placeholder="Voucher">
                                </div>  
                                <div class="Apply">
                                    <button class="btn">
                                        đồng ý
                                    </button>
                                </div>  
                            </div>
                        </div>
                    </div>
                </div>
                <hr>   
                <div class="Subtotal row">
                    <h4 class="col">Tạm tính</h4>
                    <span class="col" id = 'subtotal-amount'>{{ discounted_total|format_price }}</span>
                </div>
                <hr>
                <div class="Total mb-3 row">
                    <h4 class="col">Tổng</h4>
                    <span class="col" id = 'total-amount'>{{ discounted_total|format_price }}</span>
                </div>
                <div class="proceedCheckout">
                    {% if user.is_authenticated and cartItems > 0 %}
                        <a class="btn" href="{% url 'checkout' %}">Hoàn thành đơn hàng</a>
                    {% else %}
                        <a href="#" class="btn disabled login-action" data-authenticated="{{ user.is_authenticated|yesno:'1,0' }}">Proceed To Checkout</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    </form>
</div>

{% endblock cart-content %}